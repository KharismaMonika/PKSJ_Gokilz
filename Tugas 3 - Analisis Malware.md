# Tugas3 - Analisis Malware
##### *PKSJ Kelompok 8:*
- *Muhammad Faiez Ananda (5113100055)*
- *Ade Ilham Fajri (5113100058)*
- *Muhammad Divi Jaya N (5113100066)*

---

## Pendahuluan
Analisis malware adalah sebuah kegiatan untuk melakukan analisa dan pemeriksaan terhadap sebuah file digital yang dicurigai sebagai malware di dalam komputer. Pada kegiatan analisis malware, sebuah file diperiksa melalui beberapa tahapan dan metode yang telah disusun sedemikian rupa untuk mampu mendapatkan kesimpulan terhadap file yang diperiksa tersebut. Sehingga melalui kegiatan analisis malware dapat diperiksa secara detail dan terperinci mengenai fungsi asli dari file yang diperiksa dan bisa diambil kesimpulan dengan jelas untuk menentukan bila file tersebut merupakan malware atau file biasa.

Malicious software atau yang biasa disingkat malware merupakan sekumpulan instruksi atau program yang berjalan pada suatu sistem komputer yang membuat sistem tersebut melakukan sesuatu yang diinginkan oleh penyerang. Umumnya, malware memiliki ukuran yang relatif kecil, tetapi dengan akibat yang besar, seperti pencurian dan penghapusan data. Selain itu malware juga memiliki kemampuan untuk “menyamar” berbentuk seperti file-file umum yang akrab bagi pengguna komputer dengan menggunakan icon seperti file biasa dan memiliki ekstensi file seperti `.doc`, `.pdf`, `.xls`, `.exe`, atau bahkan berupa URL yang bisa saja mengecoh pengguna komputer untuk mengaktifkannya.

Disini kami akan melakukan analisis malware pada file yang bertipe `.xls` atau file hasil olahan Microsoft Excel. Malware tersebut akan dianalisis menggunakan Cuckoo Sandbox. Selain itu, kami juga akan melakukan pengamatan terhadap tingkah laku malware terhadap sistem yang diserang, dan bagian apa saja yang diserang pada sebuah sistem operasi, sehingga dapat diketahui bagaimana bahaya malware terhadap sistem operasi.

---

## Dasar Teori

### *Cuckoo Sandbox*
Cuckoo Sandbox adalah sebuah sistem analisis malware. Dengan kata lain, Cuckoo Sandbox secara otomatis dapat menampilkan hasil analisis tentang apa saja yang dilakukan malware pada sebuah sistem operasi. Cuckoo Sandbox dapat menganalisis berbagai macam malicious file (file executables, file DLL, dokumen PDF, dokumen office, halaman website, dan lain-lain), tracing API calls dan tingkah laku dari file tersebut, dan juga dapat menganalisis network traffic (meskipun dalam kondisi terenkripsi) dan melakukan dump.

### *Malware yang Dianalisis*
*1. Malware 1*

*2. Malware 2*

*3. Malware 3*

---

## Penjelasan Instalasi

### *Instalasi Cuckoo Sandbox*
1. Terlebih dahulu, kita harus menyiapkan/install dependensi dasar
2. `$ sudo apt-get install python python-pip python-dev libffi-dev libssl-dev libxml2-dev libxslt1-dev libjpeg-dev`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/1.PNG?raw=true)
</p>
3. `$ sudo apt-get install mongodb`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/2.PNG?raw=true)
</p>
4. Beberapa depedensi dapat diinstall sekaligus dengan syntax berikut : `$ sudo pip install -r requirements.txt`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/3.PNG?raw=true)
</p>
5. Install KVM Package ; `$ sudo apt-get install qemu-kvm libvirt-bin ubuntu-vm-builder bridge-utils python-libvirt`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/4.PNG?raw=true)
</p>
6. Install XenAPI Python package ; `$ sudo pip install XenAPI`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/5.PNG?raw=true)
</p>
7. Install install mitmproxy; `pip install mitproxy`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/6.PNG?raw=true)
</p>
8. Extract; `tar -xzf v3.5.0`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/7.PNG?raw=true)
</p>
9. Download plugin Yara dan Pydeep
10. Buka directory `Yara`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/8.PNG?raw=true)
</p>
11. Eksekusi file bootstrap.sh
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/9.PNG?raw=true)
</p>
12. Kemudian install beberapa depedensi tambahan;
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/10.PNG?raw=true)
</p>
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/11.PNG?raw=true)
</p>
13. Eksekusi file configure
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/12.PNG?raw=true)
</p>
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/13.PNG?raw=true)
</p>
14. `sudo make install`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/14.PNG?raw=true)
</p>
15. Install package TCPDump `$ sudo apt-get install tcpdump` ;
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/15.PNG?raw=true)
</p>
16. TCPdump membutuh root previlleges
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/16.PNG?raw=true)
</p>
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/17.PNG?raw=true)
</p>
17. Install `setcap` ; `$ sudo apt-get install libcap2-bin`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/18.PNG?raw=true)
</p>
18. Tambahkan username `cuckoo`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/20.PNG?raw=true)
</p>
19. Jika menggunakan VirtualBox, pastikan user yang baru tadi tergabung ke grup "vboxusers"; `$ sudo usermod -a -G vboxusers cuckoo`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/21.PNG?raw=true)
</p>
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/22.PNG?raw=true)
</p>
20. Persiapkan virtual machine yang hendak digunakan untuk uji coba malware
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/install_cuckoo1.png?raw=true)
</p>
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/23.PNG?raw=true)
</p>
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/24.PNG?raw=true)
</p>
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/25.PNG?raw=true)
</p>
21. Kemudian mengatur Iptables, dengan subnet  192.168.56.0/24; 
22. `iptables -A FORWARD -o eth0 -i vboxnet0 -s 192.168.56.0/24 -m conntrack --ctstate NEW -j ACCEPT`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/26.PNG?raw=true)
</p>
23. `iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT` 
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/27.PNG?raw=true)
</p>
24. `iptables -A POSTROUTING -t nat -j MASQUERADE`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/28.PNG?raw=true)
</p>
25. Tambahkan IP forwarding; `sysctl -w net.ipv4.ip_forward=1`
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/29.PNG?raw=true)
</p>
26. Install lagi beberapa depedensi yang sekiranya belum terinstall
<p align="center">
![alt text](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Install%20Cuckoo/30.PNG?raw=true)
</p>


## Analisis Malware

### *1. Malware1*

1.Pertama, kita akan coba akses interface website dari Cuckoo
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/1.PNG?raw=true)
</p>
2. Kemudian klik `submit`
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/2.PNG?raw=true)
</p>
3. Setelah itu silahkan upload file malware yang hendak dianalisis
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/3.PNG?raw=true)
</p>
4. File malware kita berupa file berekstensi Excel
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/4.PNG?raw=true)
</p>
5. Proses analisis oleh cuckoo telah usai
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/5.PNG?raw=true)
</p>
6. Saatnya kita analisis malware terkait
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/6.PNG?raw=true)
</p>
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/7.PNG?raw=true)
</p>
7. Berikut hasil screenshot dari aktivitas malware terkait yang dilakukan terhadap windows Xp pada VirtualBox
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/8.PNG?raw=true)
</p>
8. Malware mencoba mengakses jaringan luar (sebuah website)
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/9.PNG?raw=true)
</p>
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/14.PNG?raw=true)
</p>
9. Detail dari Malware tersebut :
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/10.PNG?raw=true)
</p>
10. Bagian Behavior Analisys;
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/11.PNG?raw=true)
</p>
11.  Bagian Network Analisys;
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/12.PNG?raw=true)
</p>
12. Incident Response
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%201/13.PNG?raw=true)
</p>

### *2. Malware 2*
1. Berikut merupakan Malware yang ke-2
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/0.PNG?raw=true)
</p>
2. Detail dari Malware
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/1.PNG?raw=true)
</p>
3. Screenshot dari aktivitas yang dilakukan malware terkait
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/2.PNG?raw=true)
</p>
4. Malware mencoba mengakses jaringan luar
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/3.PNG?raw=true)
</p>
5. Aktivitas yang dilakukan oleh Malware pada Windows Xp pada VirtualBox
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/4.PNG?raw=true)
</p>
6. Malware mencoba mengakses serta memodifikasi Registri Windows XP
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/5.PNG?raw=true)
</p>
7. TCP Analisys
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/6.PNG?raw=true)
</p>
8. Analisis akan Dropped Buffers
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/7.PNG?raw=true)
</p>
9. Risk Assessment
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/8.PNG?raw=true)
</p>
10. DNS Request dari Malware ke-2
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%202/9.PNG?raw=true)
</p>

### 3. Malware 3
1. Berikut nama dari malware ke-3 yang juga berekstensi excel
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%203/0.PNG?raw=true)
</p>
2. Incident Response
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%203/1.PNG?raw=true)
</p>
3. Analisis dari Cuckoo telah usai
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%203/2.PNG?raw=true)
</p>
4. Screenshot dari aktivitas Malware 3 terhadap Windows XP yang divirtualkan
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%203/3.PNG?raw=true)
</p>
5. Malware ke-3 ini mencoba mengakses jaringan luar
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%203/4.PNG?raw=true)
</p>
6. Proses/Aktivtas yang dilakukan oleh Malware :
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%203/5.PNG?raw=true)
</p>
7. Malware mencoba mengakses Registri Windows XP
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%203/6.PNG?raw=true)
</p>
8. Analisis Network dari malware tersebut :
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%203/7.PNG?raw=true)
</p>
9. Analisis akan Dropped Buffers
<p align="center">
![alt tag](https://github.com/adeilhamfajri/PKSJ_Gokilz/blob/master/Dokumentasi/Tugas%203%20-%20Analisis%20Malware/Malware%20Analisis/Malware%203/8.PNG?raw=true)
</p>

## Kesimpulan dan Saran

### *Kesimpulan*
1. Dengan menggunakan Cuckoo, analisis sebuah Malware dapat dilakukan secara aman, karena segala aktivitas berbahaya dari Malware tersebut diterapkan pada OS Virtual, dan itupun berada disebuah environment khusus, sehingga tidak akan membahayakan sistem sesungguhnya.
2. Penggunaan Cuckoo pada Sistem Operasi Ubuntu 16 tidak sebaik pada sistem Operasi Ubuntu 14, pasalnya pada Sistem Operasi Ubuntu 14, Cuckoo bekerja dengan maksimal.

### *Saran*
1. Sebaiknya dalam instalasi Cuckoo menggunakan satu sumber referensi yang tetap, sehingga lebih terstruktur dalam proses instalasinya.
2. Sebaiknya langsung menginstall Cuckoo pada sistem operasi Linux yang bukan Virtual, agar lebih efesien.
